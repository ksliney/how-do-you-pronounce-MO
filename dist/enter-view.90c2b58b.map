{"version":3,"sources":["enter-view.js"],"names":["factory","define","amd","module","exports","window","enterView","call","lib","selector","enter","exit","progress","offset","once","raf","ticking","elements","height","setupRaf","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","getOffsetHeight","fraction","Math","min","max","updateHeight","cH","document","documentElement","clientHeight","wH","innerHeight","updateScroll","targetFromTop","filter","el","rect","getBoundingClientRect","top","entered","__enter_view","insideIndex","length","currentEl","nextEl","progressPx","progressPct","removeEventListener","onScroll","onResize","onLoad","selectionToArray","selection","len","result","i","push","selectAll","parent","querySelectorAll","NodeList","Array","setupElements","setupEvents","addEventListener","init","valid","console","error"],"mappings":"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","file":"enter-view.90c2b58b.map","sourceRoot":"../src","sourcesContent":["/*\n* enter-view.js is library\n*/\n\n(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(factory)\n  } else if (typeof module !== 'undefined' && module.exports) {\n    module.exports = factory()\n  } else {\n    window.enterView = factory.call(this)\n  }\n})(() => {\n  const lib = ({ selector, enter, exit, progress, offset = 0, once = false }) => {\n    let raf = null\n    let ticking = false\n    let elements = []\n    let height = 0\n\n    function setupRaf () {\n      raf =\n        window.requestAnimationFrame ||\n        window.webkitRequestAnimationFrame ||\n        window.mozRequestAnimationFrame ||\n        window.msRequestAnimationFrame ||\n        function (callback) {\n          return setTimeout(callback, 1000 / 60)\n        }\n    }\n\n    function getOffsetHeight () {\n      if (offset && typeof offset === 'number') {\n        const fraction = Math.min(Math.max(0, offset), 1)\n        return height - fraction * height\n      }\n      return height\n    }\n\n    function updateHeight () {\n      const cH = document.documentElement.clientHeight\n      const wH = window.innerHeight || 0\n      height = Math.max(cH, wH)\n    }\n\n    function updateScroll () {\n      ticking = false\n      const targetFromTop = getOffsetHeight()\n\n      elements = elements.filter(el => {\n        const rect = el.getBoundingClientRect()\n        const top = rect.top\n        const entered = top < targetFromTop\n        if (entered && !el.__enter_view) {\n          enter(el)\n          if (once) return false\n        } else if (!entered && el.__enter_view && exit) {\n          exit(el)\n        }\n        el.__enter_view = entered\n\n        return true\n      })\n\n      let insideIndex = elements.filter(el => el.__enter_view).length - 1\n      if (progress && insideIndex < elements.length && insideIndex != -1) {\n        let currentEl = elements[insideIndex]\n        let nextEl = elements[insideIndex + 1]\n        const rect = currentEl.getBoundingClientRect()\n\n        const progressPx = targetFromTop - rect.top\n        let progressPct = progressPx / rect.height\n\n        if (progressPct > 1) { progressPct = 1 }\n        progress(currentEl, nextEl, progressPct)\n      }\n\n      if (!elements.length) {\n        window.removeEventListener('scroll', onScroll, true)\n      }\n    }\n\n    function onScroll () {\n      if (!ticking) {\n        ticking = true\n        raf(updateScroll)\n      }\n    }\n\n    function onResize () {\n      updateHeight()\n      updateScroll()\n    }\n\n    function onLoad () {\n      updateHeight()\n      updateScroll()\n    }\n\n    function selectionToArray (selection) {\n      const len = selection.length\n      const result = []\n      for (let i = 0; i < len; i += 1) {\n        result.push(selection[i])\n      }\n      return result\n    }\n\n    function selectAll (selector, parent = document) {\n      if (typeof selector === 'string') {\n        return selectionToArray(parent.querySelectorAll(selector))\n      } else if (selector instanceof NodeList) {\n        return selectionToArray(selector)\n      } else if (selector instanceof Array) {\n        return selector\n      }\n    }\n\n    function setupElements () {\n      elements = selectAll(selector)\n    }\n\n    function setupEvents () {\n      window.addEventListener('resize', onResize, true)\n      window.addEventListener('scroll', onScroll, true)\n      window.addEventListener('load', onLoad, true)\n      onResize()\n    }\n\n    function init () {\n      const valid = selector && enter\n      if (!valid) console.error('must set selector and enter options')\n      setupRaf()\n      setupElements()\n      setupEvents()\n      updateScroll()\n    }\n\n    init()\n  }\n\n  return lib\n})\n"]}